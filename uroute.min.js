class URoute{constructor(){this.routes=[],this.currentPath=window.location.pathname,this.notFoundHandler=null,this.loadingHandler=null,this.isLoading=!1,this._initEventListeners()}route(i,t,e={}){var n=i.replace(/{([^/]+)}/g,"([^/]+)"),a=(i.match(/{([^/]+)}/g)||[]).map(t=>t.replace(/{|}/g,""));let s={path:i,regex:new RegExp(`^${n}$`),paramNames:a,callback:t,options:e,children:[]},r=(this.routes.push(s),this._checkRoute(),{child:(t,e,n={})=>{t.startsWith(i)||(t=i.endsWith("/")?i+t.substring(1):i+t);t=this.route(t,e,n);return s.children.push(t),r},getRouter:()=>this});return r}navigate(t){return window.history.pushState(null,null,t),this.currentPath=t,this._checkRoute(),this}_initEventListeners(){window.addEventListener("popstate",()=>{this.currentPath=window.location.pathname,this._checkRoute()}),document.addEventListener("click",t=>{var e=t.target.closest("a");!e||!(e=e.getAttribute("href"))||e.startsWith("http")||e.startsWith("//")||e.startsWith("#")||(t.preventDefault(),this.navigate(e))})}_checkRoute(){var t=this.currentPath;this._startLoading();for(let i of this.routes){var e=t.match(i.regex);if(e){let n={};return 0<i.paramNames.length&&1<e.length&&e.slice(1).forEach((t,e)=>{n[i.paramNames[e]]=t}),void setTimeout(()=>{i.callback(n),this._endLoading()},0)}}this.notFoundHandler?setTimeout(()=>{this.notFoundHandler(),this._endLoading()},0):(console.warn("No route found for path: "+t),this._endLoading())}_startLoading(){this.isLoading=!0,this.loadingHandler&&this.loadingHandler(!0)}_endLoading(){this.isLoading=!1,this.loadingHandler&&this.loadingHandler(!1)}start(){return this._checkRoute(),this}notFound(t){return this.notFoundHandler=t,this}whenLoading(t){return this.loadingHandler=t,this}}
